# Copyright (c) 2003-2004 E. Will et al.
# Rights to this code are documented in doc/LICENSE.
#
# This file contains build instructions.
#
# $Id: Makefile.in 7473 2007-01-14 03:37:24Z nenolod $
#

CC		= @CC@
RM		= @RM@
MV		= @MV@
CP		= @CP@
INSTALL		= @INSTALL@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
datadir		= @datadir@
sysconfdir	= @sysconfdir@
libdir		= @libdir@
sbindir		= @sbindir@
localstatedir	= @localstatedir@
DOCDIR		= @DOCDIR@
MODDIR		= @MODDIR@
SHAREDIR	= @SHAREDIR@
BIN		= atheme@EXEEXT@
MKDEP		= @MKDEP@ -DPREFIX=\"@prefix@\" -I../include @PGINC@
PICFLAGS	= @PICFLAGS@
CFLAGS		= @CFLAGS@ -I../include -I../libatheme @PGINC@

LIBS		= @LIBS@ @PQLIB@
LDFLAGS		= @LDFLAGS@
CPPFLAGS	= @CPPFLAGS@

default: all

BASE_SRCS = 

SRCS = ${BASE_SRCS}

OBJS = ${SRCS:.c=.so}

SUBDIRS = backend crypto protocol chanserv nickserv global operserv xmlrpc memoserv saslserv gameserv

all: modules

build: all

install: build
	@for i in $(SUBDIRS); do \
		echo "install ==> $$i"; \
		cd $$i; \
		${MAKE} install || exit; cd ..; \
	done
	-${RM} -f $(DESTDIR)${MODDIR}/modules/userserv/main.so

modules:
	@for i in $(SUBDIRS); do \
		echo "build ==> $$i"; \
		cd $$i; \
		${MAKE} build || exit; cd ..; \
	done

.SUFFIXES: .so

.c.so:
	${CC} ${PICFLAGS} ${CPPFLAGS} ${CFLAGS} $< -o $@

.PHONY: depend clean distclean
depend:
	@for i in $(SUBDIRS); do \
		echo "depend ==> $$i"; \
		cd $$i; \
		touch .depend; \
		${MAKE} depend; cd ..; \
	done

clean:
	@for i in $(SUBDIRS); do \
		echo "clean ==> $$i"; \
		cd $$i; \
		${MAKE} clean || exit; cd ..; \
	done

distclean: clean
	${RM} -f Makefile version.c.last
